<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MAESTRO ‚Äî Cockpit KPI (Fiori-style)</title>
<style>
  :root{
    --bg:#f6f7fb; --card:#ffffff; --ink:#101828;
    --muted:#6b7280; --grid:#e5e7eb; --grid-strong:#cbd5e1;
    --blue:#2563eb; --marker:#111827;
    --ok:#22c55e; --mid:#f59e0b; --bad:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.5 Inter,system-ui,Segoe UI,Roboto,Arial}
  .shell{max-width:1280px;margin:24px auto;padding:0 16px}
  .toolbar{
    display:flex;gap:12px;flex-wrap:wrap;margin-bottom:16px;
    position:sticky;top:0;z-index:5;background:linear-gradient(#f6f7fb,#f6f7fbcc 80%,#0000)
  }
  .toolbar select{
    padding:10px 12px;border:1px solid var(--grid);border-radius:10px;background:#fff;color:#111827;font-weight:600
  }
  .grid{
    display:grid;gap:16px;
    grid-template-columns: 1fr 1fr;
  }
  @media (max-width:1100px){ .grid{grid-template-columns:1fr} }

  .card{background:var(--card);border:1px solid var(--grid);border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.05);overflow:hidden}
  .card h3{margin:0;padding:14px 16px;border-bottom:1px solid var(--grid);font-weight:700}
  .legend{display:flex;gap:16px;align-items:center;color:var(--muted);font-size:12px;padding:6px 16px 0 16px}
  .dot{display:inline-block;width:14px;height:14px;border-radius:3px;margin-right:6px}
  /* Tooltips */
  .tt{position:relative}
  .tt[data-tip]:hover::after{
    content:attr(data-tip);
    position:absolute;z-index:10;left:50%;top:-6px;transform:translate(-50%,-100%);
    background:#111827;color:#fff;padding:6px 8px;border-radius:6px;font-size:12px;white-space:nowrap;
    box-shadow:0 6px 16px rgba(0,0,0,.22);
  }
  /* ===== Graphique 1: D√©lai moyen ===== */
  .g1-wrap{padding:14px 16px 18px 16px}
  .g1-row{display:grid;grid-template-columns: 220px 1fr 92px;align-items:center;gap:12px;margin:8px 0}
  .g1-label{font-weight:600;color:#374151}
  .g1-barbox{position:relative;height:28px;background:#f3f4f6;border:1px solid var(--grid);border-radius:8px;overflow:hidden}
  .g1-real{position:absolute;left:0;top:0;bottom:0;background:var(--blue)}
  .g1-real .val{position:absolute;right:6px;top:50%;transform:translateY(-50%);font-weight:700;color:#fff;font-variant-numeric:tabular-nums}
  .g1-marker{position:absolute;top:-2px;bottom:-2px;width:0;border-left:2px solid var(--marker)}
  .g1-marker::after{content:"";position:absolute;top:50%;left:-3px;transform:translateY(-50%);width:6px;height:6px;border-radius:2px;background:var(--marker)}
  .g1-delta{font-variant-numeric:tabular-nums;font-weight:700}
  .g1-delta.good{color:var(--ok)} .g1-delta.bad{color:var(--bad)}
  .g1-legend .dash{display:inline-block;width:18px;height:0;border-top:2px solid var(--marker);margin-right:6px;transform:translateY(-3px)}
  .g1-legend .rect{display:inline-block;width:18px;height:8px;background:var(--blue);border-radius:2px;margin-right:6px}

  /* ===== Graphique 2: OTD barres empil√©es ===== */
  .g2-wrap{padding:14px 16px 18px 16px}
  .g2-row{display:grid;grid-template-columns: 220px 1fr 72px;align-items:center;gap:12px;margin:8px 0}
  .g2-label{font-weight:600;color:#374151}
  .g2-bar{display:flex;height:28px;border-radius:6px;overflow:hidden;border:1px solid var(--grid)}
  .g2-seg{height:100%;position:relative;cursor:default;font-variant-numeric:tabular-nums}
  .g2-seg span{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:12px;font-weight:700;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.4)}
  .g2-ok{background:var(--ok)} .g2-mid{background:var(--mid)} .g2-bad{background:var(--bad)}

  /* ===== Graphique 3: Heatmap capacit√© ===== */
  .g3-wrap{padding:12px 16px 16px 16px}
  .g3-heat{
    display:grid;
    grid-template-columns: 280px repeat(13, 1fr); /* 13 semaines */
    gap: 0; /* cellules coll√©es */
    border:1px solid var(--grid);
    border-radius:8px;
    overflow:hidden;
    background:#fff;
  }
  .g3-head, .g3-shop{ background:#f9fafb; font-weight:600 }
  .g3-head, .g3-cell, .g3-shop{
    padding:8px 10px; border-right:1px solid var(--grid); border-bottom:1px solid var(--grid);
    white-space:nowrap; text-overflow:ellipsis; overflow:hidden;
  }
  .g3-row{display:contents}
  .u-ok{ background:#22c55e; color:#06260f }
  .u-high{ background:#f59e0b; color:#1f1503 }
  .u-over{ background:#ef4444; color:#ffffff }
  .g3-sep-left{ border-left:2px solid var(--grid-strong) !important }
  .g3-cell{ position:relative; text-align:center; font-variant-numeric:tabular-nums; }
  .g3-cell .pct{ font-weight:800; letter-spacing:.2px }
</style>
</head>
<body>
  <div class="shell">
    <!-- Barre de s√©lecteurs (statiques) -->
    <div class="toolbar" aria-label="Filtres statiques">
      <select aria-label="P√©riode">
        <option>Derniers 3 mois</option>
        <option>Derniers 6 mois</option>
        <option>Ann√©e en cours (YTD)</option>
        <option>12 derni√®res semaines</option>
      </select>
      <select aria-label="Centres">
        <option>Tous centres (50)</option>
        <option>Safran AE ‚Äî Villaroche</option>
        <option>MTU ‚Äî Munich</option>
        <option>Delta TechOps ‚Äî Atlanta</option>
        <option>SAESL ‚Äî Singapore</option>
      </select>
      <select aria-label="Type d‚Äôop√©ration">
        <option>Toutes op√©rations</option>
        <option>Inspection</option>
        <option>R√©paration</option>
        <option>Assemblage</option>
        <option>Test banc</option>
      </select>
      <select aria-label="Type de demande">
        <option>Toutes demandes</option>
        <option>Overhaul complet</option>
        <option>Deep Repair</option>
        <option>AOG</option>
        <option>Scheduled Check</option>
        <option>Quick Inspection</option>
      </select>
      <select aria-label="Moteur">
        <option>Tous moteurs (10)</option>
        <option>CFM56-5B</option><option>CFM56-7B</option>
        <option>LEAP-1A</option><option>LEAP-1B</option><option>LEAP-1C</option>
        <option>CF34-10E</option><option>GE90-115B</option><option>GEnx-1B</option>
        <option>Silvercrest</option><option>TP400-D6</option>
      </select>
    </div>

    <!-- Ligne 1 : Graphique 1 + Graphique 2 -->
    <div class="grid">
      <!-- Graphique 1 -->
      <div class="card" id="g1-card">
        <h3>‚è±Ô∏è D√©lai moyen ‚Äî R√©el (barre) vs Pr√©vu (trait)</h3>
        <div class="legend g1-legend">
          <span><i class="rect"></i>R√©el (jours)</span>
          <span><i class="dash"></i>Pr√©vu (jours)</span>
        </div>
        <div class="g1-wrap" id="g1-rows"></div>
      </div>

      <!-- Graphique 2 -->
      <div class="card" id="g2-card">
        <h3>üìä On-Time Delivery ‚Äî r√©partition par moteur</h3>
        <div class="legend">
          <span><i class="dot" style="background:var(--ok)"></i>√Ä l‚Äôheure (>90%)</span>
          <span><i class="dot" style="background:var(--mid)"></i>L√©ger retard (75‚Äì90%)</span>
          <span><i class="dot" style="background:var(--bad)"></i>Retard critique (<75%)</span>
        </div>
        <div class="g2-wrap" id="g2-rows"></div>
      </div>
    </div>

    <!-- Ligne 2 : Graphique 3 pleine largeur -->
    <div class="card" id="g3-card" style="margin-top:16px">
      <h3>‚öôÔ∏è Utilisation des capacit√©s ‚Äî 3 mois (13 semaines) ‚Äî 20 centres</h3>
      <div class="legend">
        <span><i class="dot" style="background:var(--ok)"></i>< 85%</span>
        <span><i class="dot" style="background:var(--mid)"></i>85‚Äì100%</span>
        <span><i class="dot" style="background:var(--bad)"></i>> 100%</span>
      </div>
      <div class="g3-wrap">
        <div class="g3-heat" id="g3-heat">
          <!-- En-t√™tes -->
          <div class="g3-head">Centre</div>
          <div class="g3-head g3-sep-left">S1</div><div class="g3-head">S2</div><div class="g3-head">S3</div><div class="g3-head">S4</div>
          <div class="g3-head g3-sep-left">S5</div><div class="g3-head">S6</div><div class="g3-head">S7</div><div class="g3-head">S8</div>
          <div class="g3-head g3-sep-left">S9</div><div class="g3-head">S10</div><div class="g3-head">S11</div><div class="g3-head">S12</div>
          <div class="g3-head g3-sep-left">S13</div>
          <!-- Lignes inject√©es en JS -->
        </div>
      </div>
    </div>
  </div>

<script>
/* ========= Helpers ========= */
function jitter(v, minMul, maxMul){
  const f = minMul + Math.random()*(maxMul-minMul);
  return Math.round(v * f);
}

/* ========= G1: D√©lai moyen ========= */
const g1Data = [
  {type:"Overhaul complet",        planned: jitter(60,0.95,1.05), real: jitter(60,0.85,1.35)},
  {type:"Deep Repair",             planned: jitter(45,0.95,1.05), real: jitter(45,0.85,1.35)},
  {type:"AOG ‚Äî Aircraft On Ground",planned: jitter(7, 0.95,1.05), real: jitter(7, 0.70,1.60)},
  {type:"Scheduled Check",         planned: jitter(20,0.95,1.05), real: jitter(20,0.80,1.30)},
  {type:"Quick Inspection",        planned: jitter(5, 0.95,1.05), real: jitter(5, 0.70,1.50)},
];
const g1Max = Math.max(...g1Data.flatMap(d=>[d.planned,d.real]))*1.1;
const g1Rows = document.getElementById('g1-rows');
g1Data.forEach(d=>{
  const row = document.createElement('div'); row.className='g1-row';
  const lab = document.createElement('div'); lab.className='g1-label'; lab.textContent=d.type; row.appendChild(lab);

  const box = document.createElement('div'); box.className='g1-barbox tt';
  const realPct = Math.min(100,(d.real/g1Max)*100);
  const planPct = Math.min(100,(d.planned/g1Max)*100);
  const bar = document.createElement('div'); bar.className='g1-real'; bar.style.width=realPct+'%';
  const val = document.createElement('div'); val.className='val'; val.textContent=d.real+' j'; bar.appendChild(val);
  const mk = document.createElement('div'); mk.className='g1-marker'; mk.style.left=planPct+'%';

  const diff = d.real - d.planned;
  const diffPct = Math.round((diff/d.planned)*100);
  box.setAttribute('data-tip', `Pr√©vu: ${d.planned} j ‚Ä¢ R√©el: ${d.real} j ‚Ä¢ √âcart: ${diff>=0?'+':''}${diff} j (${diffPct>=0?'+':''}${diffPct}%)`);

  box.appendChild(bar); box.appendChild(mk); row.appendChild(box);

  const delta = document.createElement('div'); delta.className='g1-delta '+(diff<=0?'good':'bad');
  delta.textContent = `${diff>=0?'+':''}${diff} j (${diffPct>=0?'+':''}${diffPct}%)`;
  row.appendChild(delta);

  g1Rows.appendChild(row);
});

/* ========= G2: OTD par moteur ========= */
const engines = ["CFM56-5B (A320)","CFM56-7B (B737)","LEAP-1A (A320neo)","LEAP-1B (737 MAX)","GE90-115B (B777)","GEnx-1B (B787)","CF34-10E (E190/E195)","Silvercrest (Falcon)","TP400-D6 (A400M)","LEAP-1C (C919)"];
function splitDemands(total){
  const green = Math.round(total * (0.6 + Math.random()*0.25)); // 60‚Äì85%
  const orange = Math.round(total * (0.1 + Math.random()*0.15)); // 10‚Äì25%
  const red = Math.max(0,total - green - orange);
  return {green,orange,red};
}
const g2Data = engines.map(name=>{
  const total = 30 + Math.floor(Math.random()*70);
  return {name,total,...splitDemands(total)};
});
const g2Rows = document.getElementById('g2-rows');
g2Data.forEach(d=>{
  const row = document.createElement('div'); row.className='g2-row';
  const lab = document.createElement('div'); lab.className='g2-label'; lab.textContent=d.name; row.appendChild(lab);

  const bar = document.createElement('div'); bar.className='g2-bar';
  [{cls:'g2-ok',val:d.green,txt:'√† l‚Äôheure'},
   {cls:'g2-mid',val:d.orange,txt:'l√©ger retard'},
   {cls:'g2-bad',val:d.red,txt:'retard critique'}]
  .filter(p=>p.val>0)
  .forEach(p=>{
    const seg = document.createElement('div'); seg.className=`g2-seg ${p.cls} tt`;
    const pct = Math.round((p.val/d.total)*100);
    seg.style.width = pct+'%';
    seg.setAttribute('data-tip', `${p.val} demandes ${p.txt} ‚Ä¢ ${pct}%`);
    const span = document.createElement('span'); span.textContent=pct+'%';
    seg.appendChild(span);
    bar.appendChild(seg);
  });
  row.appendChild(bar);

  const total = document.createElement('div'); total.textContent = d.total + " ops";
  row.appendChild(total);

  g2Rows.appendChild(row);
});

/* ========= G3: Heatmap capacit√© (13 semaines, 20 centres) ========= */
const centers = [
  "Safran AE ‚Äî Villaroche (FR)","Safran AE ‚Äî Ch√¢tellerault (FR)","Safran Nacelles ‚Äî Le Havre (FR)","Safran HE ‚Äî Bordes (FR)",
  "Air France Industries ‚Äî Orly (FR)","Lufthansa Technik ‚Äî Hamburg (DE)","MTU Aero Engines ‚Äî Munich (DE)","SR Technics ‚Äî Zurich (CH)",
  "SAESL ‚Äî Singapore (SG)","Delta TechOps ‚Äî Atlanta (US)","GE Aerospace ‚Äî Cincinnati (US)","HAECO ‚Äî Xiamen (CN)",
  "ST Engineering ‚Äî Seletar (SG)","Iberia MRO ‚Äî Madrid (ES)","TAP M&E ‚Äî Lisbonne (PT)","KLM E&M ‚Äî Amsterdam (NL)",
  "Magnetic MRO ‚Äî Tallinn (EE)","Rolls-Royce ‚Äî Derby (UK)","Pratt & Whitney ‚Äî East Hartford (US)","Etihad Engineering ‚Äî Abu Dhabi (AE)"
];
const baseCapacity = centers.map((_, i)=>[40,50,60,70,80,90,100,110,120][i%9]);
function generateWeekUtil(ci){
  const arr=[]; const cap=baseCapacity[ci]; const phase=(ci*0.6)%(2*Math.PI);
  for(let w=0; w<13; w++){
    const sin=0.85+0.18*Math.sin((w/3.2)+phase);
    const noise=(Math.random()*0.14)-0.07;
    let util=Math.max(0.55, Math.min(1.25, sin+noise));
    const planned=Math.round(util*cap); const pct=Math.round((planned/cap)*100);
    arr.push({cap,planned,pct});
  }
  return arr;
}
function utilCls(p){ if(p>100)return'u-over'; if(p>=85)return'u-high'; return'u-ok'; }

const g3 = document.getElementById('g3-heat');
centers.forEach((name, idx)=>{
  const shop = document.createElement('div'); shop.className='g3-shop'; shop.textContent=name; g3.appendChild(shop);
  const weeks=generateWeekUtil(idx);
  weeks.forEach((w,i)=>{
    const cell=document.createElement('div');
    cell.className=`g3-cell ${utilCls(w.pct)} ` + (i===0||i===4||i===8||i===12?'g3-sep-left':'');
    cell.setAttribute('data-tip', `S${i+1} ‚Ä¢ ${w.pct}% ‚Ä¢ ${w.planned}/${w.cap}`);
    const pct=document.createElement('div'); pct.className='pct'; pct.textContent=w.pct+'%';
    cell.appendChild(pct); g3.appendChild(cell);
  });
});
</script>
</body>
</html>
